import{r as c,s as Y}from"./request-Bgo0R4ex.js";import{s as C,a as F,b as Z,c as y}from"./index-B4eeL8v7.js";import{d as ee,u as te,a as p,b as ae,c as v,g as n,h as a,w as s,f as l,F as le,o as u,j as ne,A as h,v as g,e as D,i as b}from"./index-BhphhWz3.js";import{d as _,t as se,u as ie,l as oe}from"./dayjs.min-DJwYnCML.js";import{s as re,S as G}from"./SignaturePad-CFtk3ttj.js";import{s as A}from"./index-VMAvQEL8.js";import{s as r}from"./index-DM_fNY5D.js";import{s as P}from"./index-4g7UpuIZ.js";import"./index-C9DMT5eE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={style:{"padding-left":"10%","padding-right":"10%","padding-top":"5rem","padding-bottom":"2rem",display:"flex","flex-flow":"column",gap:"1rem"}},ue={style:{width:"100%",display:"flex","flex-flow":"column",gap:"1rem"}},pe={style:{display:"flex","flex-flow":"row nowrap",width:"40%"}},fe={style:{display:"flex","flex-flow":"column"}},me={key:0},ve={key:1},ye={key:0,style:{"font-size":"13px",background:"orange",color:"white",padding:"0.2rem 0.5rem","border-radius":"5px","font-weight":"bold"}},ge={key:1,style:{"font-size":"13px",background:"green",color:"white",padding:"0.2rem 0.5rem","border-radius":"5px","font-weight":"bold"}},be={key:2,style:{"font-size":"13px",background:"red",color:"white",padding:"0.2rem 0.5rem","border-radius":"5px","font-weight":"bold"}},we={key:3,style:{"font-size":"13px",background:"grey",color:"white",padding:"0.2rem 0.5rem","border-radius":"5px","font-weight":"bold"}},ke={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},xe={style:{display:"flex","flex-flow":"column",gap:"0.5rem"}},_e={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},je={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},he={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center"}},ce={key:0,style:{width:"100%"}},Ce={key:1,style:{width:"200px"}},Ve={key:0,style:{"background-color":"#ccc",padding:"5px 10px","border-radius":"5px","font-size":"12px"}},De={key:1,style:{"background-color":"green",color:"#fff",padding:"5px 10px","border-radius":"5px","font-size":"12px"}},Pe=["onClick"],$e={style:{width:"25vw",display:"flex","flex-flow":"column",gap:"0.5rem"}},ze={style:{"font-size":"12px"}},Te={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem","margin-bottom":"0.5rem"}},Ue={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem","margin-bottom":"0.5rem"}},Ye={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem","margin-bottom":"0.5rem"}},Ae={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem","margin-bottom":"0.5rem"}},Be={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem","margin-bottom":"0.5rem"}},Ee={style:{display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",gap:"0.5rem","margin-bottom":"0.5rem"}},Se={style:{display:"flex","flex-flow":"column","align-items":"center","justify-content":"center",padding:"30px",gap:"0.5rem"}},Oe=["src"],Me={style:{width:"250px",display:"flex","flex-flow":"column",gap:"0.5rem"}},He={style:{width:"250px",display:"flex","flex-flow":"column",gap:"0.5rem"}},Je={style:{width:"250px",display:"flex","flex-flow":"column",gap:"0.5rem"}},Ne={style:{width:"18vw",display:"flex","flex-flow":"column",gap:"0.5rem"}},et=ee({__name:"ClientHistory",setup(Fe){_.extend(se),_.extend(ie),_.locale(oe);const f=te(),H=p([]),J=[{label:"Menunggu",value:"pending"},{label:"Disetujui",value:"approved"},{label:"Ditolak",value:"rejected"},{label:"Draf",value:"draft"},{label:"Semua",value:"all"}],B=p(J[4].value),j=()=>{const o={status:B.value};c.post("pengajuan/history",o).then(e=>{H.value=e.payload}).catch(e=>{console.error(e),f.add({severity:"error",summary:"Error",detail:"Gagal mendapatkan data pengajuan"})})},x=p({}),w=p(!1),$=p(!1),K=o=>{x.value=o,w.value=!0},q=o=>{if(o==null||o===""){f.add({severity:"warn",summary:"Peringatan",detail:"Tanda tangan tidak boleh kosong"});return}x.value.ttd=o,$.value=!1},z=p(null),I=()=>{c.post("pengajuan/delete",{_id:x.value._id}).then(o=>{f.add({severity:"success",summary:"Berhasil",detail:"Pengajuan berhasil dihapus"}),w.value=!1,j(),z.value.hide()}).catch(o=>{console.error(o),f.add({severity:"error",summary:"Error",detail:"Gagal menghapus pengajuan"})})},E=p(null),L=()=>{c.post("pengajuan/update-status",{_id:x.value._id,status:"draft"}).then(o=>{f.add({severity:"success",summary:"Berhasil",detail:"Pengajuan berhasil ditarik",life:3e3}),w.value=!1,j(),E.value.hide()}).catch(o=>{console.error(o),f.add({severity:"error",summary:"Error",detail:"Gagal menarik pengajuan",life:3e3})})},S=p(null),R=()=>{c.post("pengajuan/update-status",{_id:x.value._id,status:"pending"}).then(o=>{f.add({severity:"success",summary:"Berhasil",detail:"Pengajuan berhasil diajukan",life:3e3}),w.value=!1,j(),S.value.hide()}).catch(o=>{console.error(o),f.add({severity:"error",summary:"Error",detail:"Gagal mengajukan pengajuan",life:3e3})})},m=p({}),V=p(!1),N=p({}),O=p(null),i=p({name:m.value.name||"",nip:"",jabatan:"",email:"",date:_().tz("Asia/Jakarta").format(),ttd:""}),T=p(!1),Q=o=>{if(o==null||o===""){f.add({severity:"warn",summary:"Peringatan",detail:"Tanda tangan tidak boleh kosong"});return}i.value.ttd=o},W=()=>{if(i.value.name===""||i.value.nip===""||i.value.jabatan===""||i.value.email===""||i.value.date===""||i.value.ttd===""){f.add({severity:"warn",summary:"Peringatan",detail:"Semua field harus diisi"});return}const o={id_proposal:m.value._id,id_item:N.value._id,...i.value};c.post("pengajuan/request-return",o).then(e=>{f.add({severity:"success",summary:"Berhasil",detail:"Pengajuan pengembalian berhasil dikirim",life:3e3}),T.value=!1,V.value=!1,j(),i.value={name:m.value.name||"",nip:"",jabatan:"",email:"",date:_().tz("Asia/Jakarta").format(),ttd:""}}).catch(e=>{console.error(e),f.add({severity:"error",summary:"Error",detail:"Gagal mengajukan pengembalian",life:3e3})})},U=p({}),M=p(null),X=o=>{const e={id_proposal:m.value._id,id_item:o._id};c.post("pengajuan/return-reset",e).then(d=>{f.add({severity:"success",summary:"Berhasil",detail:"Data pengembalian berhasil direset",life:3e3}),j()}).catch(d=>{console.error(d),f.add({severity:"error",summary:"Error",detail:"Gagal mereset data pengembalian",life:3e3})})};return ae(()=>{j()}),(o,e)=>{const d=ne("fasicon");return u(),v(le,null,[n("div",de,[e[25]||(e[25]=n("div",{style:{width:"100%",display:"flex","flex-flow":"column",gap:"1rem"}},[n("h1",{style:{margin:"0",padding:"0"}},"Pengajuan Saya")],-1)),n("div",ue,[n("div",pe,[a(l(C),{variant:"in",style:{width:"100%"}},{default:s(()=>[a(l(Z),{modelValue:B.value,"onUpdate:modelValue":e[0]||(e[0]=t=>B.value=t),options:J,"option-label":"label","option-value":"value",style:{width:"100%"},onChange:j},null,8,["modelValue"]),e[24]||(e[24]=n("label",null,"Filter Status",-1))]),_:1,__:[24]})]),n("div",fe,[a(l(F),{value:H.value},{default:s(()=>[a(l(y),null,{body:s(({})=>[a(d,{icon:"file-lines"})]),_:1}),a(l(y),{header:"RegisterID",style:{width:"20%"}},{body:s(({data:t})=>[n("code",null,h(t._id),1)]),_:1}),a(l(y),{header:"Diajukan",style:{width:"20%"}},{body:s(({data:t})=>[n("code",null,h(l(_).utc(t.date).tz("Asia/Jakarta").format("ddd, DD MMM YYYY HH:mm:ss")),1)]),_:1}),a(l(y),{header:"Jenis",style:{width:"20%"}},{body:s(({data:t})=>[t.jenis_barang==="inv_common"?(u(),v("span",me,"Umum")):t.jenis_barang==="inv_laptop"?(u(),v("span",ve,"Khusus (Laptop)")):g("",!0)]),_:1}),a(l(y),{header:"Status",style:{width:"20%"}},{body:s(({data:t})=>[t.status==="pending"?(u(),v("span",ye,"Sedang review")):t.status==="approved"?(u(),v("span",ge,"Disetujui")):t.status==="rejected"?(u(),v("span",be,"Ditolak")):t.status==="draft"?(u(),v("span",we,"Draft")):g("",!0)]),_:1}),a(l(y),null,{body:s(({data:t})=>[n("div",ke,[a(l(r),{onClick:k=>{m.value=t,V.value=!0},style:{"font-size":"13px"}},{default:s(()=>[a(d,{icon:"list"})]),_:2},1032,["onClick"]),t.status==="draft"?(u(),D(l(r),{key:0,onClick:k=>{S.value.show(k),x.value=t}},{default:s(()=>[a(d,{icon:"paper-plane"})]),_:2},1032,["onClick"])):g("",!0),t.status!=="approved"?(u(),D(l(r),{key:1,class:"p-button-outlined",onClick:k=>K(t)},{default:s(()=>[a(d,{icon:"edit"})]),_:2},1032,["onClick"])):g("",!0),t.status==="draft"?(u(),D(l(r),{key:2,class:"p-button-outlined p-button-danger",onClick:k=>{z.value.show(k),x.value=t}},{default:s(()=>[a(d,{icon:"trash"})]),_:2},1032,["onClick"])):g("",!0)])]),_:1})]),_:1},8,["value"])])])]),a(l(A),{header:"Edit",style:{width:"30vw"},visible:w.value,"onUpdate:visible":e[4]||(e[4]=t=>w.value=t)},{default:s(()=>[n("div",xe,[n("div",_e,[e[27]||(e[27]=n("label",null,"Perbarui Tanda Tangan",-1)),a(l(r),{style:{width:"180px"},onClick:e[1]||(e[1]=t=>$.value=!0)},{default:s(()=>[a(d,{icon:"pen"}),e[26]||(e[26]=b(" Perbaru",-1))]),_:1,__:[26]})]),n("div",je,[e[29]||(e[29]=n("label",null,"Tarik Proposal",-1)),a(l(r),{disabled:m.value.status!=="draft",style:{width:"180px"},class:"p-button-danger p-button-outlined",onClick:e[2]||(e[2]=t=>E.value.show(t))},{default:s(()=>[a(d,{icon:"arrow-left"}),e[28]||(e[28]=b(" Tarik",-1))]),_:1,__:[28]},8,["disabled"])]),n("div",he,[e[31]||(e[31]=n("label",null,"Hapus Proposal",-1)),a(l(r),{style:{width:"180px"},class:"p-button-danger p-button-outlined",onClick:e[3]||(e[3]=t=>z.value.show(t))},{default:s(()=>[a(d,{icon:"trash"}),e[30]||(e[30]=b(" Hapus",-1))]),_:1,__:[30]})])])]),_:1},8,["visible"]),a(l(A),{header:"Item",style:{width:"50vw"},modal:"",visible:V.value,"onUpdate:visible":e[5]||(e[5]=t=>V.value=t)},{default:s(()=>[a(l(F),{value:m.value.items},{default:s(()=>[a(l(y),{header:"Nama Barang",style:{width:"40%"}},{body:s(({data:t})=>[n("span",null,h(t.inv.nama),1)]),_:1}),a(l(y),{header:"Kode",style:{width:"40%"}},{body:s(({data:t})=>[n("span",null,h(t.inv.kode_aset),1)]),_:1}),a(l(y),{header:"Jumlah",style:{width:"20%"}},{body:s(({data:t})=>[n("span",null,h(t.qty),1)]),_:1}),m.value.status==="approved"?(u(),D(l(y),{key:0,header:"Aksi"},{body:s(({data:t})=>[t.return_data.status==="idle"?(u(),v("div",ce,[a(l(r),{onClick:k=>{N.value=t,O.value.toggle(k)},style:{"font-size":"13px"}},{default:s(()=>[a(d,{icon:"arrow-up-right-from-square"}),e[32]||(e[32]=b(" Kembalikan",-1))]),_:2,__:[32]},1032,["onClick"])])):(u(),v("div",Ce,[t.return_data.status==="pending"?(u(),v("span",Ve,"Diajukan, mengunggu...")):g("",!0),t.return_data.status==="approved"?(u(),v("span",De,"Disetujui")):g("",!0),t.return_data.status==="rejected"?(u(),v("span",{key:2,onClick:k=>{U.value=t,M.value.toggle(k)},style:{cursor:"pointer","background-color":"red",color:"#fff",padding:"5px 10px","border-radius":"5px","font-size":"12px"}},"Ditolak",8,Pe)):g("",!0)]))]),_:1})):g("",!0)]),_:1},8,["value"])]),_:1},8,["visible"]),a(l(P),{ref_key:"rejectOp",ref:M},{default:s(()=>[n("div",$e,[e[34]||(e[34]=n("span",{style:{"font-weight":"bold"}},"Ajuan Anda ditolak",-1)),n("span",ze,"Alasan Penolakan: "+h(U.value.return_data.rejection_reason),1),a(l(r),{class:"p-button-danger",onClick:e[6]||(e[6]=t=>{U.value&&M.value.toggle(),X(U.value),V.value=!1})},{default:s(()=>e[33]||(e[33]=[b("Ajukan Ulang!",-1)])),_:1,__:[33]})])]),_:1},512),a(l(A),{header:"Form Pengembalian Barang",visible:T.value,"onUpdate:visible":e[18]||(e[18]=t=>T.value=t),style:{width:"35vw",display:"flex"},modal:""},{default:s(()=>[n("div",Te,[a(l(C),{variant:"in",style:{width:"100%"}},{default:s(()=>[a(l(Y),{modelValue:i.value.name,"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.name=t),style:{width:"100%"}},null,8,["modelValue"]),e[35]||(e[35]=n("label",null,"Nama Lengkap",-1))]),_:1,__:[35]}),a(l(r),{onClick:e[8]||(e[8]=t=>i.value.name=m.value.name)},{default:s(()=>[a(d,{icon:"refresh"})]),_:1})]),n("div",Ue,[a(l(C),{variant:"in",style:{width:"100%"}},{default:s(()=>[a(l(Y),{modelValue:i.value.nip,"onUpdate:modelValue":e[9]||(e[9]=t=>i.value.nip=t),style:{width:"100%"}},null,8,["modelValue"]),e[36]||(e[36]=n("label",null,"NIP",-1))]),_:1,__:[36]}),a(l(r),{onClick:e[10]||(e[10]=t=>i.value.nip=m.value.nip)},{default:s(()=>[a(d,{icon:"refresh"})]),_:1})]),n("div",Ye,[a(l(C),{variant:"in",style:{width:"100%"}},{default:s(()=>[a(l(Y),{modelValue:i.value.jabatan,"onUpdate:modelValue":e[11]||(e[11]=t=>i.value.jabatan=t),style:{width:"100%"}},null,8,["modelValue"]),e[37]||(e[37]=n("label",null,"Jabatan",-1))]),_:1,__:[37]}),a(l(r),{onClick:e[12]||(e[12]=t=>i.value.jabatan=m.value.jabatan)},{default:s(()=>[a(d,{icon:"refresh"})]),_:1})]),n("div",Ae,[a(l(C),{variant:"in",style:{width:"100%"}},{default:s(()=>[a(l(Y),{modelValue:i.value.email,"onUpdate:modelValue":e[13]||(e[13]=t=>i.value.email=t),style:{width:"100%"}},null,8,["modelValue"]),e[38]||(e[38]=n("label",null,"E-mail",-1))]),_:1,__:[38]}),a(l(r),{onClick:e[14]||(e[14]=t=>i.value.email=m.value.email)},{default:s(()=>[a(d,{icon:"refresh"})]),_:1})]),n("div",Be,[a(l(C),{variant:"in",style:{width:"100%"}},{default:s(()=>[a(l(re),{modelValue:i.value.date,"onUpdate:modelValue":e[15]||(e[15]=t=>i.value.date=t),onChange:e[16]||(e[16]=t=>i.value.date=l(_).utc(i.value.date).tz("Asia/Jakarta").format()),style:{width:"100%"},dateFormat:"dd/mm/yy"},null,8,["modelValue"]),n("label",null,"Tanggal ("+h(l(_)(i.value.date).format("dddd, DD MMM YYYY"))+")",1)]),_:1})]),n("div",Ee,[a(G,{"onUpdate:onreset":e[17]||(e[17]=t=>i.value.ttd=""),style:{border:"1px solid #ccc",width:"100%"},"onUpdate:signature":Q})]),i.value.ttd?(u(),D(l(r),{key:0,onClick:W},{default:s(()=>[a(d,{icon:"paper-plane"}),e[39]||(e[39]=b(" Ajukan Pengembalian",-1))]),_:1,__:[39]})):g("",!0)]),_:1},8,["visible"]),a(l(A),{header:"Tanda Tangan",style:{width:"35vw"},modal:"",visible:$.value,"onUpdate:visible":e[19]||(e[19]=t=>$.value=t)},{default:s(()=>[n("div",Se,[e[40]||(e[40]=n("span",null,"TTD saat ini: ",-1)),n("img",{src:x.value.ttd,style:{width:"200px",padding:"10px","border-radius":"10px",border:"1px solid #ccc"}},null,8,Oe)]),a(G,{style:{border:"1px solid #ccc"},"onUpdate:signature":q})]),_:1},8,["visible"]),a(l(P),{ref_key:"deleteOp",ref:z},{default:s(()=>[n("div",Me,[e[42]||(e[42]=n("span",{style:{"font-weight":"bold"}},"Yakin ingin menghapus pengajuan ini?",-1)),e[43]||(e[43]=n("span",{style:{"font-size":"12px"}},"Tindakan ini tidak dapat dibatalkan.",-1)),a(l(r),{class:"p-button-danger",onClick:e[20]||(e[20]=t=>{w.value=!1,I()})},{default:s(()=>e[41]||(e[41]=[b("Ya, Hapus",-1)])),_:1,__:[41]})])]),_:1},512),a(l(P),{ref_key:"draftOp",ref:E},{default:s(()=>[n("div",He,[e[45]||(e[45]=n("span",{style:{"font-weight":"bold"}},"Tarik proposal ini?",-1)),e[46]||(e[46]=n("span",{style:{"font-size":"12px"}},"Status akan diubah menjadi draf",-1)),a(l(r),{class:"p-button-danger",onClick:e[21]||(e[21]=t=>{w.value=!1,L()})},{default:s(()=>e[44]||(e[44]=[b("Ya, Tarik",-1)])),_:1,__:[44]})])]),_:1},512),a(l(P),{ref_key:"proposeOp",ref:S},{default:s(()=>[n("div",Je,[e[48]||(e[48]=n("span",{style:{"font-weight":"bold"}},"Ajukan proposal?",-1)),e[49]||(e[49]=n("span",{style:{"font-size":"12px"}},"Proposal akan diajukan!",-1)),a(l(r),{onClick:e[22]||(e[22]=t=>{w.value=!1,R()})},{default:s(()=>e[47]||(e[47]=[b("Ya, Ajukan",-1)])),_:1,__:[47]})])]),_:1},512),a(l(P),{ref_key:"returnOp",ref:O},{default:s(()=>[n("div",Ne,[e[51]||(e[51]=n("label",{style:{"font-weight":"bold"}},"Konfirmasi",-1)),e[52]||(e[52]=n("span",null,"Yakin ingin mengembalikan barang ini?",-1)),a(l(r),{onClick:e[23]||(e[23]=t=>{T.value=!0,O.value.toggle()})},{default:s(()=>e[50]||(e[50]=[b("Ya, kembalikan",-1)])),_:1,__:[50]})])]),_:1},512)],64)}}});export{et as default};
